<html>

<body>
    <canvas width="500" height="500">
        An alternative text describing what your canvas displays.
    </canvas>
</body>
<style>
    body {
        background: darkslategrey;
    }
</style>
<script>
    const DIRECTIONS = {
        LEFT: 'left',
        RIGHT: 'right',
        UP: 'up',
        DOWN: 'down'
    }

    function isTheSamePosition(position1, position2) {
        return position1.x === position2.x && position1.y === position2.y
    }

    function generateRandomPosition(max) {
        return {
            x: Math.floor((Math.random() * max)) + 1,
            y: Math.floor((Math.random() * max)) + 1
        }
    }

    class Grid {
        divisions = 5;

        draw(ctx) {
            ctx.fillStyle = "black";
            ctx.strokeStyle = "gray";
            for (let xPosition = 1; xPosition <= this.divisions; xPosition++) {
                for (let yPosition = 1; yPosition <= this.divisions; yPosition++) {
                    const startX = (xPosition - 1) * lengthOfBlockEdge;
                    const startY = (yPosition - 1) * lengthOfBlockEdge;
                    ctx.beginPath();
                    ctx.rect(startX, startY, lengthOfBlockEdge, lengthOfBlockEdge);
                    ctx.stroke();
                }
            }
        }
    }

    class FoodBlock {
        constructor() {
            this.position = this.getNewPosition()
        }

        getNewPosition = (snake = {}) => {
            return generateRandomPosition(grid.divisions);
        }

        position = this.getNewPosition();
    }

    class Snake {
        position = {
            x: 5,
            y: 5
        }
        direction = DIRECTIONS.RIGHT

        setNewPosition(position) {
            if (position.x <= grid.divisions && position.y <= grid.divisions && position.x >= 1 && position.y >= 1) {
                this.position = position;
            }
        }
    }

    const grid = new Grid();
    const foodBlock = new FoodBlock();
    const snake = new Snake();
    const canvas = document.querySelector("canvas");
    const lengthOfBlockEdge = canvas.width / grid.divisions;


    function main() {
        document.addEventListener('keydown', onKeyDown)
        const ctx = canvas.getContext("2d");
        draw(ctx);

        setInterval(() => {
            console.log({ snake })
            updateGame()
            draw(ctx);
        }, 1000)
    }

    function onKeyDown(event) {
        console.log(mapKeyToDirection(event.key))
        snake.direction = mapKeyToDirection(event.key)
    }

    function mapKeyToDirection(key) {
        switch (key) {
            case 'ArrowLeft':
                return DIRECTIONS.LEFT
            case 'ArrowRight':
                return DIRECTIONS.RIGHT
            case 'ArrowUp':
                return DIRECTIONS.UP
            case 'ArrowDown':
                return DIRECTIONS.DOWN

        }
    }


    function draw(ctx) {
        drawBackground(ctx);
        grid.draw(ctx);
        drawSnake(ctx);
        drawFoodBlock(ctx);
    }

    function drawBackground(ctx) {
        ctx.fillStyle = "white";
        ctx.fillRect(0, 0, canvas.width, canvas.width);
    }

    function drawSnake(ctx) {
        drawBlockInXYPosition(ctx, snake.position.x, snake.position.y, 'green')
    }

    function drawFoodBlock(ctx) {
        drawBlockInXYPosition(ctx, foodBlock.position.x, foodBlock.position.y, 'red')
    }

    function drawBlockInXYPosition(ctx, x, y, colour) {
        ctx.fillStyle = colour;
        ctx.fillRect((x * lengthOfBlockEdge) - lengthOfBlockEdge, (y * lengthOfBlockEdge - lengthOfBlockEdge), lengthOfBlockEdge, lengthOfBlockEdge);
    }

    function setNewSnakePosition() {
        if (snake.direction === DIRECTIONS.RIGHT) {
            snake.setNewPosition({ x: snake.position.x + 1, y: snake.position.y })
        }
        if (snake.direction === DIRECTIONS.LEFT) {
            snake.setNewPosition({ x: snake.position.x - 1, y: snake.position.y })
        }
        if (snake.direction === DIRECTIONS.UP) {
            snake.setNewPosition({ x: snake.position.x, y: snake.position.y - 1 })
        }
        if (snake.direction === DIRECTIONS.DOWN) {

            snake.setNewPosition({ x: snake.position.x, y: snake.position.y + 1 })
        }
    }

    function updateGame() {
        setNewSnakePosition()
        console.log({ foodBlock })
        if (isTheSamePosition(snake.position, foodBlock.position)) {
            foodBlock.position = foodBlock.getNewPosition(snake);
        }
    }

    main();

</script>

</html>